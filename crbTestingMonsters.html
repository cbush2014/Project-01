<!DOCTYPE html>
<html lang="en">
​

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>D&D API</title>
</head>
​

<body>


    <script src="http://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script>
        jQuery.ajaxPrefilter(function (options) {
            if (options.crossDomain && jQuery.support.cors) {
                options.url = "http://uncc-cors-proxy.herokuapp.com/" + options.url;
            }
        });
    </script>
    ​
    <script>
        var searchQuery = "";

        // QUERY 3----MONSTERS TABLE-------------------------------------------      
        //  from the Monsters table we can get: name, hit_points, hit_dice, challenge_rating
        // searchQuery = "monsters/?name=Adult+Bronze+Dragon";

        // var monsterArray = [
        //     [],[],[],[]
        // ];

        var monsterArray = JSON.parse(localStorage.getItem('DnD') || "[ [],[],[],[] ]");


        function getMonster() {
            var rdm = Math.floor(Math.random() * 325);
            searchQuery = "monsters/" + rdm.toString();

            $.ajax({
                url: "http://dnd5eapi.co/api/" + searchQuery,
                method: "GET"
            }).then(function (response) {

                setMonster(response);
            });

        }
    

        function setMonster(monster) {

            var newMonster = {};
            newMonster.name = monster.name;
            newMonster.damage_bonus = Math.floor((monster.strength / 3) + 1 ); 
            newMonster.hit_points = monster.hit_points;
            newMonster.challenge_rating = monster.challenge_rating;
            newMonster.imageUrl = 'https://fakeimg.pl/200x200/ff0000,128/333333,255/?text=' + monster.name + '&font=lobster'
            console.log("--------------------------");
            console.log(monster);
            console.log(monster.name);
            console.log(newMonster.damage_bonus);
            console.log(monster.hit_points);
            console.log(monster.challenge_rating);
            console.log("--------------------------");

            if (monster.challenge_rating < 1) {
                // Easy
                monsterArray[0].push(newMonster);

            } else if (monster.challenge_rating < 4) {
                // Medium
                monsterArray[1].push(newMonster);
            } else if (monster.challenge_rating < 9) {
                // Hard
                monsterArray[2].push(newMonster);
            } else {
                // INSANE
                monsterArray[3].push(newMonster);
            }           
            
            localStorage.setItem('DnD', JSON.stringify(monsterArray));

        }

        for (var i = 0; i < 50; i++) {
            getMonster();
        }
        function monsterImg (){
            $("#monsterIMG").attr("src", "https://www.google.com/search?q=bear&rlz=1C1CHBF_enUS862US862&sxsrf=ACYBGNSBan4k1p_d33NN_QsW_NYNWsf8BQ:1572891437079&source=lnms&tbm=isch&sa=X&ved=0ahUKEwjz_YGbldHlAhUHZd8KHaZDDXEQ_AUIEigB&biw=1536&bih=722")
        }



    </script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript">
    var keyword = monster.name;
    $(document).ready(function(){
        $.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",
        {
            tags: keyword,
            tagmode: "any",
            format: "json"
        },
        function(data) {
            var rnd = Math.floor(Math.random() * data.items.length);
            var image_src = data.items[rnd]['media']['m'].replace("_m", "_b");
            $('body').css('background-image', "url('" + image_src + "')");
        });
    });
    </script>
</body>
​

</html>